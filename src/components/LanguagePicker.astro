---
import { t, astroI18n } from "astro-i18n";

import pngGermany from "@assets/flag_germany.png?url";
import pngRussia from "@assets/flag_russia.png?url";
import pngSerbia from "@assets/flag_serbia.png?url";
import pngUnitedKingdom from "@assets/flag_uk.png?url";

const LANGUAGES: Record<Locale, { pngSrc: string; label: string }> = {
  de: {
    pngSrc: pngGermany,
    label: t("languagePicker.german", undefined, { locale: "de" }),
  },
  en: {
    pngSrc: pngUnitedKingdom,
    label: t("languagePicker.english", undefined, { locale: "en" }),
  },
  ru: {
    pngSrc: pngRussia,
    label: t("languagePicker.russian", undefined, { locale: "ru" }),
  },
  sr: {
    pngSrc: pngSerbia,
    label: t("languagePicker.serbian", undefined, { locale: "sr" }),
  },
} as const;
---

<div class="dropdown dropdown-end">
  <div tabindex="0" role="button" class="tooltip tooltip-left cursor-pointer" data-tip={t("languagePicker.tooltip")}>
    <span class="flex items-center -space-x-3">
      {
        Object.keys(LANGUAGES)
          .filter((langCode) => langCode !== astroI18n.locale)
          .map((langCode) => {
            const langKey = langCode as keyof typeof LANGUAGES; // Ensures the correct key type
            return (
              <img
                class="h-5 w-5 grayscale md:h-7 md:w-7"
                src={LANGUAGES[langKey].pngSrc}
                alt={LANGUAGES[langKey].label}
              />
            );
          })
      }
      <span class="avatar">
        <span class="h-8 w-8 md:h-12 md:w-12">
          <img src={LANGUAGES[astroI18n.locale].pngSrc} alt={LANGUAGES[astroI18n.locale].label} />
        </span>
      </span>
    </span>
  </div>

  <ul tabindex="0" class="menu dropdown-content rounded-box z-2 mt-4 bg-white p-2 shadow-xl">
    {
      Object.keys(LANGUAGES)
        .filter((langCode) => langCode !== astroI18n.locale)
        .map((langCode) => {
          const langKey = langCode as keyof typeof LANGUAGES; // Ensures the correct key type
          return (
            <li>
              <a href={`/${langCode}${astroI18n.route}`} data-astro-reload>
                <div class="w-7">
                  <img class="h-5 w-5 md:h-7 md:w-7" src={LANGUAGES[langKey].pngSrc} alt={LANGUAGES[langKey].label} />
                </div>
                <div class="w-28">{LANGUAGES[langKey].label}</div>
              </a>
            </li>
          );
        })
    }
  </ul>
</div>
